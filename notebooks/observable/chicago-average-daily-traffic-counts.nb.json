{
  "id": "3c6a1ee56e29e7ef",
  "slug": "chicago-average-daily-traffic-counts",
  "trashed": false,
  "description": "",
  "likes": 0,
  "publish_level": "public",
  "forks": 1,
  "fork_of": {
    "id": "59ba6f4a102f4f95",
    "slug": "chicago-traffic-crashes",
    "title": "Chicago Traffic Crashes",
    "owner": {
      "id": "17b72db66175b428",
      "github_login": "RandomFractals",
      "avatar_url": "https://avatars1.githubusercontent.com/u/656833?v=4",
      "login": "randomfractals",
      "name": "Taras Novak",
      "bio": "I map ğŸŒ & graph  ğŸ“ˆ data ğŸˆ¸ ",
      "home_url": "https://www.linkedin.com/in/tarasnovak",
      "type": "individual"
    },
    "version": 113
  },
  "update_time": "2021-06-14T14:50:29.941Z",
  "publish_time": "2021-06-14T11:31:09.469Z",
  "publish_version": 159,
  "thumbnail": "969fe39600d7add3b39fd73709a1ff4f4394de49d1a485882ca7b0f867d69c86",
  "default_thumbnail": "969fe39600d7add3b39fd73709a1ff4f4394de49d1a485882ca7b0f867d69c86",
  "roles": [],
  "sharing": null,
  "owner": {
    "id": "17b72db66175b428",
    "github_login": "RandomFractals",
    "avatar_url": "https://avatars1.githubusercontent.com/u/656833?v=4",
    "login": "randomfractals",
    "name": "Taras Novak",
    "bio": "I map ğŸŒ & graph  ğŸ“ˆ data ğŸˆ¸ ",
    "home_url": "https://www.linkedin.com/in/tarasnovak",
    "type": "individual"
  },
  "creator": {
    "id": "17b72db66175b428",
    "github_login": "RandomFractals",
    "avatar_url": "https://avatars1.githubusercontent.com/u/656833?v=4",
    "login": "randomfractals",
    "name": "Taras Novak",
    "bio": "I map ğŸŒ & graph  ğŸ“ˆ data ğŸˆ¸ ",
    "home_url": "https://www.linkedin.com/in/tarasnovak"
  },
  "collections": [
    {
      "id": "5b60600584ed4fe0",
      "type": "public",
      "slug": "leaflet",
      "title": "Leaflet",
      "description": "Notebooks using Leaflet JS map library.",
      "update_time": "2021-06-08T11:57:15.608Z",
      "pinned": false,
      "ordered": true,
      "custom_thumbnail": null,
      "thumbnail": "a45c7c16fbf5ac1eb4353dfdf63b495eb2bcf61fd77f4dfbbd7d1d1e95c72ed7",
      "listing_count": 9,
      "parent_collection_count": 0,
      "owner": {
        "id": "17b72db66175b428",
        "github_login": "RandomFractals",
        "avatar_url": "https://avatars1.githubusercontent.com/u/656833?v=4",
        "login": "randomfractals",
        "name": "Taras Novak",
        "bio": "I map ğŸŒ & graph  ğŸ“ˆ data ğŸˆ¸ ",
        "home_url": "https://www.linkedin.com/in/tarasnovak",
        "type": "individual"
      }
    },
    {
      "id": "c30622739accf157",
      "type": "public",
      "slug": "arquero",
      "title": "Arquero",
      "description": "Notebooks using Arquero JS library for manipulating data.",
      "update_time": "2021-06-08T11:51:29.570Z",
      "pinned": false,
      "ordered": false,
      "custom_thumbnail": null,
      "thumbnail": "f195a105405d38650d0fe79da26bb5a91994a4a231481a4ab062d223c36de082",
      "listing_count": 8,
      "parent_collection_count": 0,
      "owner": {
        "id": "17b72db66175b428",
        "github_login": "RandomFractals",
        "avatar_url": "https://avatars1.githubusercontent.com/u/656833?v=4",
        "login": "randomfractals",
        "name": "Taras Novak",
        "bio": "I map ğŸŒ & graph  ğŸ“ˆ data ğŸˆ¸ ",
        "home_url": "https://www.linkedin.com/in/tarasnovak",
        "type": "individual"
      }
    },
    {
      "id": "cf858224d6488195",
      "type": "public",
      "slug": "transportation",
      "title": "Transportation",
      "description": "Public transportation notebooks",
      "update_time": "2021-06-04T03:34:03.975Z",
      "pinned": false,
      "ordered": false,
      "custom_thumbnail": null,
      "thumbnail": "f195a105405d38650d0fe79da26bb5a91994a4a231481a4ab062d223c36de082",
      "listing_count": 12,
      "parent_collection_count": 0,
      "owner": {
        "id": "17b72db66175b428",
        "github_login": "RandomFractals",
        "avatar_url": "https://avatars1.githubusercontent.com/u/656833?v=4",
        "login": "randomfractals",
        "name": "Taras Novak",
        "bio": "I map ğŸŒ & graph  ğŸ“ˆ data ğŸˆ¸ ",
        "home_url": "https://www.linkedin.com/in/tarasnovak",
        "type": "individual"
      }
    },
    {
      "id": "cc3985e6b82c86b0",
      "type": "public",
      "slug": "maps",
      "title": "Maps",
      "description": "Various Maps",
      "update_time": "2018-09-28T13:20:05.815Z",
      "pinned": false,
      "ordered": false,
      "custom_thumbnail": null,
      "thumbnail": "855f4654e70feece820af1cd690a1484039e8d6ca1d77d5d080bf96fcbbcb192",
      "listing_count": 16,
      "parent_collection_count": 0,
      "owner": {
        "id": "17b72db66175b428",
        "github_login": "RandomFractals",
        "avatar_url": "https://avatars1.githubusercontent.com/u/656833?v=4",
        "login": "randomfractals",
        "name": "Taras Novak",
        "bio": "I map ğŸŒ & graph  ğŸ“ˆ data ğŸˆ¸ ",
        "home_url": "https://www.linkedin.com/in/tarasnovak",
        "type": "individual"
      }
    }
  ],
  "files": [],
  "comments": [],
  "commenting_lock": null,
  "version": 159,
  "title": "Chicago Average Daily Traffic Counts",
  "license": null,
  "copyright": "",
  "nodes": [
    {
      "id": 0,
      "value": "md`# Chicago Average Daily Traffic Counts\n\nData Source: [Chicago Transportation](https://data.cityofchicago.org/browse?category=Transportation) / [Average Daily Traffic Counts](https://dev.socrata.com/foundry/data.cityofchicago.org/pf56-35rv)\n\nChicago Data Portal: [Average Daily Traffic Counts Map](https://data.cityofchicago.org/Transportation/Average-Daily-Traffic-Counts-Map/pf56-35rv)\n`",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 55,
      "value": "map = {\n  // create map container\n  let mapContainer = DOM.element('div', { style: `width:${width}px;height:${width/1.6}px` });\n  yield mapContainer;\n  \n  // create leaflet map with attributions\n  let map = L.map(mapContainer).setView([41.85, -87.68], 10); // Chicago origins\n  let osmLayer = L.tileLayer( // 'https://maps.wikimedia.org/osm-intl/{z}/{x}/{y}@2x.png')\n    'https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}.png', {\n    attribution: '&copy; <a href=\\\"http://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors, &copy; <a href=\\\"http://cartodb.com/attributions\\\">CartoDB</a>',\n    detectRetina: false,\n    maxZoom: 18,\n    minZoom: 10,\n    noWrap: false,\n    subdomains: 'abc'\n  }).addTo(map);\n\n  // create hit points for the heatmap layer\n  let hitPoints = geoData.features.map(feature => \n    feature.geometry.coordinates.slice().reverse().concat([0.1])); // intensity\n  \n  // add heat layer\n  let heatmapLayer = heatLayer(hitPoints, {\n    minOpacity: 0.12,\n    maxZoom: 18,\n    max: 1.0,\n    radius: 8,\n    blur: 5,\n    gradient: null\n  }).addTo(map);\n  \n  // dot marker\n  const marker = {\n    radius: 6,\n    fillColor: \"steelblue\",\n    color: \"#0000ff\",\n    weight: 1,\n    opacity: 1,\n    fillOpacity: 0.8\n  };\n  \n  // map markers\n  const pointToLayer = function (feature, latlng) {\n    return L.circleMarker(latlng, marker);\n  }\n  \n  // add markers\n  let markers = markerCluster({});\n  let geoLayer = L.geoJson(geoData, {\n    pointToLayer: pointToLayer,    \n    onEachFeature: function (feature, layer) {\n      const data = feature.properties;\n      const html = `<div class=\"popup\">\n          <h3>${data.traffic_volume_count_location_address} ${data.street}</h3>\n          <p>Vehicle Volume: ${data.total_passing_vehicle_volume.toLocaleString()}</p>\n          <p>${data.vehicle_volume_by_each_direction_of_traffic}</p>\n          <p>Recorded on: ${data.date.toLocaleDateString()}</p>\n        </div>`;\n      layer.bindPopup(html);\n      layer.bindTooltip(`${data.traffic_volume_count_location_address}  ${data.street} <br />\n        Vehicle Volume: ${data.total_passing_vehicle_volume.toLocaleString()}`, {sticky: true});\n    }\n  });  \n  \n  markers.addLayer(geoLayer);\n  map.addLayer(markers);\n  \n  // map.fitBounds(markers.getBounds());\n}",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 139,
      "value": "markerStyles = html`\n<style type=\"text/css\">\n  div.popup p { \n    margin: 4px 0;\n    font-size: 14px;\n  }\n</style>`",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 7,
      "value": "md`## Data`",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 38,
      "value": "viewof tableView = Inputs.table(data, {\n  columns: columns,\n  reverse: true\n})",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 10,
      "value": "md`## Data Queries and Filters`",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 40,
      "value": "columns = [\n  'id',\n  'date_of_count',\n  'traffic_volume_count_location_address',\n  'street',\n  'total_passing_vehicle_volume',\n  'vehicle_volume_by_each_direction_of_traffic',\n  'latitude',\n  'longitude'\n]",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 19,
      "value": "dataUrl = 'https://data.cityofchicago.org/resource/pf56-35rv.json'",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 22,
      "value": "query = `?$limit=100000`",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 31,
      "value": "data = await fetch(dataUrl + query).then(data => data.json())",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 66,
      "value": "geoData = getGeoDataPoints(dataTable.objects())",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 93,
      "value": "dataTable = aq.from(data)\n  .derive({\n    date: d => op.parse_date(d.date_of_count)\n  })\n  .orderby('total_passing_vehicle_volume')",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 12,
      "value": "md`## Imports`",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 15,
      "value": "import { aq, op } from '@uwdata/arquero'",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 62,
      "value": "import { getGeoDataPoints } from '@randomfractals/geo-data-utils'",
      "pinned": false,
      "mode": "js"
    },
    {
      "id": 56,
      "value": "leafletStyles = html`<link href='${resolve('leaflet@1.7.1/dist/leaflet.css')}' rel='stylesheet' />`",
      "pinned": true,
      "mode": "js"
    },
    {
      "id": 59,
      "value": "L = require('leaflet@1.7.1')",
      "pinned": true,
      "mode": "js"
    },
    {
      "id": 74,
      "value": "heatLayer = L, require('leaflet.heat').catch(() =>  L.heatLayer)",
      "pinned": true,
      "mode": "js"
    },
    {
      "id": 68,
      "value": "markerClusterStyles = html`<link href='${resolve('leaflet.markercluster@1.2.0/dist/MarkerCluster.Default.css')}' rel='stylesheet' />`",
      "pinned": true,
      "mode": "js"
    },
    {
      "id": 70,
      "value": "markerCluster = L, require('leaflet.markercluster@1.2.0').catch(() => L.markerClusterGroup)",
      "pinned": true,
      "mode": "js"
    }
  ]
}